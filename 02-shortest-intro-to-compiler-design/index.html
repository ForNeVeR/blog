

<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title></title>

      
        <link rel="alternate" type="application/rss+xml" title="RSS" href="https:&#x2F;&#x2F;gsomix.github.io&#x2F;blog&#x2F;rss.xml">
      

      
          <script src="https://cdnjs.cloudflare.com/ajax/libs/slideout/1.0.1/slideout.min.js"></script>
      

      
          <link rel="stylesheet" href="https:&#x2F;&#x2F;gsomix.github.io&#x2F;blog&#x2F;site.css">
      

      
      
    </head>

    <body>
        <div class="container">

            <div id="mobile-navbar" class="mobile-navbar">
              <div class="mobile-header-logo">
                <a href="/" class="logo">Blog</a>
              </div>
              <div class="mobile-navbar-icon icon-out">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>

            <nav id="mobile-menu" class="mobile-menu slideout-menu slideout-menu-left">
              <ul class="mobile-menu-list">
                
                    <li class="mobile-menu-item">
                        <a href="https://gsomix.github.io/blog">
                            Home
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https://gsomix.github.io/blog&#x2F;categories">
                            Categories
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https://gsomix.github.io/blog&#x2F;tags">
                            Tags
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https://gsomix.github.io/blog&#x2F;rss.xml">
                            RSS
                        </a>
                    </li>
                
              </ul>
            </nav>

            <header id="header">
                <div class="logo"><a href="https:&#x2F;&#x2F;gsomix.github.io&#x2F;blog">Blog</a></div>
                <nav class="menu">
                    <ul>
                        
                            <li>
                                <a href="https://gsomix.github.io/blog">
                                    Home
                                </a>
                            </li>
                        
                            <li>
                                <a href="https://gsomix.github.io/blog&#x2F;categories">
                                    Categories
                                </a>
                            </li>
                        
                            <li>
                                <a href="https://gsomix.github.io/blog&#x2F;tags">
                                    Tags
                                </a>
                            </li>
                        
                            <li>
                                <a href="https://gsomix.github.io/blog&#x2F;rss.xml">
                                    RSS
                                </a>
                            </li>
                        
                    </ul>
                </nav>
            </header>

            <main>
                <div class="content" id="mobile-panel">
                    


<div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">Contents</h2>
    <div class="post-toc-content always-active">
        <nav id="TableOfContents">
            <ul>
                
                <li>
                    <a href="https://gsomix.github.io/blog/02-shortest-intro-to-compiler-design/#introduction" class="toc-link">Introduction</a>
                    
                </li>
                
                <li>
                    <a href="https://gsomix.github.io/blog/02-shortest-intro-to-compiler-design/#syntactic-analysis" class="toc-link">Syntactic analysis</a>
                    
                </li>
                
                <li>
                    <a href="https://gsomix.github.io/blog/02-shortest-intro-to-compiler-design/#translation-into-c-code" class="toc-link">Translation into C code</a>
                    
                </li>
                
                <li>
                    <a href="https://gsomix.github.io/blog/02-shortest-intro-to-compiler-design/#our-first-compiler" class="toc-link">Our first compiler</a>
                    
                    <ul>
                        
                        <li>
                            <a href="https://gsomix.github.io/blog/02-shortest-intro-to-compiler-design/#ssa-form" class="toc-link">SSA form</a>
                        </li>
                        
                    </ul>
                    
                </li>
                
            </ul>
        </nav>
    </div>
</div>


<article class="post">
    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;gsomix.github.io&#x2F;blog&#x2F;02-shortest-intro-to-compiler-design&#x2F;">Shortest introduction to the compiler design</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2018-12-21</span>
            
        </div>
    </header>

    <div class="post-content">
      <p><em>Authors: Peter Sovietov, Evgeniy Andreev</em></p>
<p><em>This article is part of <a href="https://sergeytihon.com/2018/10/22/f-advent-calendar-in-english-2018/">F# Advent calendar in English 2018</a>. You may find original article in Russian with Python examples <a href="https://github.com/true-grue/Compiler-Development/wiki/%D0%9A%D1%80%D0%B0%D1%82%D1%87%D0%B0%D0%B9%D1%88%D0%B5%D0%B5-%D0%B2%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B2-%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5-%D0%BA%D0%BE%D0%BC%D0%BF%D0%B8%D0%BB%D1%8F%D1%82%D0%BE%D1%80%D0%B0-(Python)">here</a>.</em></p>
<h2 id="introduction">Introduction</h2>
<p>Let's build a compiler of arithmetic expressions in F#. The compiler should translate source code in Reverse Polish notation (<a href="https://en.wikipedia.org/wiki/Reverse_Polish_notation">RPN</a>) into intermediate representation (IR) suitable for a stack machine. However, we're not going to build an IR interpreter as you might think. We are going to translate IR right into C language code!</p>
<h2 id="syntactic-analysis">Syntactic analysis</h2>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">type </span><span style="color:#c0c5ce;">IR </span><span style="color:#b48ead;">=</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">|</span><span style="color:#c0c5ce;"> Push </span><span style="color:#b48ead;">of </span><span style="color:#c0c5ce;">int</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">|</span><span style="color:#c0c5ce;"> Op </span><span style="color:#b48ead;">of </span><span style="color:#c0c5ce;">string</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">scan </span><span style="color:#b48ead;">(</span><span style="color:#bf616a;">source</span><span style="color:#b48ead;">: </span><span style="color:#c0c5ce;">string</span><span style="color:#b48ead;">) =</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">tokens </span><span style="color:#b48ead;">=</span><span style="color:#c0c5ce;"> source.Split </span><span style="color:#a3be8c;">&#39; &#39;</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">[ for</span><span style="color:#c0c5ce;"> tok </span><span style="color:#b48ead;">in</span><span style="color:#c0c5ce;"> tokens </span><span style="color:#b48ead;">-&gt; </span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">match</span><span style="color:#c0c5ce;"> Int32.TryParse tok </span><span style="color:#b48ead;">with</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">| </span><span style="color:#d08770;">true</span><span style="color:#b48ead;">,</span><span style="color:#c0c5ce;"> num </span><span style="color:#b48ead;">-&gt;</span><span style="color:#c0c5ce;"> Push num</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">| _ -&gt;</span><span style="color:#c0c5ce;"> Op tok  </span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">]</span><span style="color:#c0c5ce;">
</span></pre>
<p>What've we done here? The <code>scan</code> function takes a line from the user in RPN, e.g. <code>2 2 +</code>. Basically it is both lexer and parser of our compiler. There are various approaches: lexer and parser might be separated (e.g. generated by <a href="https://fsprojects.github.io/FsLexYacc/">FsLex and FsYacc</a>) or joined (e.g. implemented with parser combinators library, <a href="http://www.quanttec.com/fparsec/">FParsec</a>). Output of the <code>scan</code> function is IR, a list of stack machine operations modeled with discriminated union:</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">[</span><span style="color:#c0c5ce;"> Push </span><span style="color:#d08770;">2</span><span style="color:#b48ead;">; </span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#c0c5ce;">Push </span><span style="color:#d08770;">2</span><span style="color:#b48ead;">; </span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#c0c5ce;">Op &quot;</span><span style="color:#a3be8c;">+</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">]</span><span style="color:#c0c5ce;">
</span></pre>
<p>OK, this is already a working compiler, just not a serious one. For example, we can push incorrect operations onto the stack, so we need to introduce another discriminated union (like <code>IR</code>) for the operations possible in our compiler. Let's leave that as an excersise. Recall that we are going to generate C code as output!</p>
<h2 id="translation-into-c-code">Translation into C code</h2>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">let </span><span style="color:#bf616a;">trans </span><span style="color:#b48ead;">(</span><span style="color:#bf616a;">ir</span><span style="color:#b48ead;">: </span><span style="color:#c0c5ce;">IR list</span><span style="color:#b48ead;">) =</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">[ for</span><span style="color:#c0c5ce;"> instr </span><span style="color:#b48ead;">in</span><span style="color:#c0c5ce;"> ir </span><span style="color:#b48ead;">do</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">match</span><span style="color:#c0c5ce;"> instr </span><span style="color:#b48ead;">with</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">|</span><span style="color:#c0c5ce;"> Push value </span><span style="color:#b48ead;">-&gt; </span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">yield</span><span style="color:#c0c5ce;"> sprintf &quot;</span><span style="color:#a3be8c;">  st[sp] = </span><span style="color:#b48ead;">%d</span><span style="color:#a3be8c;">;</span><span style="color:#c0c5ce;">&quot; value</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">yield </span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">  sp += 1;</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">|</span><span style="color:#c0c5ce;"> Op op </span><span style="color:#b48ead;">-&gt; </span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">yield</span><span style="color:#c0c5ce;"> sprintf &quot;</span><span style="color:#a3be8c;">  st[sp - 2] = st[sp - 2] </span><span style="color:#b48ead;">%s</span><span style="color:#a3be8c;"> st[sp - 1];</span><span style="color:#c0c5ce;">&quot; op</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">yield </span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">  sp -= 1;</span><span style="color:#c0c5ce;">&quot; </span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">] |&gt;</span><span style="color:#c0c5ce;"> String.concat &quot;</span><span style="color:#d08770;">\n</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#c0c5ce;">
</span></pre>
<p>What's going on? The <code>trans</code> function uses pattern matching to translate a list of IR instructions into C code. Pattern matching is a very convenient feature for compiler implementation. Let's see output for the <code>2 2 +</code> expression.</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">  </span><span style="color:#c0c5ce;">st</span><span style="color:#b48ead;">[</span><span style="color:#c0c5ce;">sp</span><span style="color:#b48ead;">] = </span><span style="color:#d08770;">2</span><span style="color:#b48ead;">;</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#c0c5ce;">sp </span><span style="color:#b48ead;">+= </span><span style="color:#d08770;">1</span><span style="color:#b48ead;">;</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#c0c5ce;">st</span><span style="color:#b48ead;">[</span><span style="color:#c0c5ce;">sp</span><span style="color:#b48ead;">] = </span><span style="color:#d08770;">2</span><span style="color:#b48ead;">;</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#c0c5ce;">sp </span><span style="color:#b48ead;">+= </span><span style="color:#d08770;">1</span><span style="color:#b48ead;">;</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#c0c5ce;">st</span><span style="color:#b48ead;">[</span><span style="color:#c0c5ce;">sp </span><span style="color:#b48ead;">- </span><span style="color:#d08770;">2</span><span style="color:#b48ead;">] =</span><span style="color:#c0c5ce;"> st</span><span style="color:#b48ead;">[</span><span style="color:#c0c5ce;">sp </span><span style="color:#b48ead;">- </span><span style="color:#d08770;">2</span><span style="color:#b48ead;">] +</span><span style="color:#c0c5ce;"> st</span><span style="color:#b48ead;">[</span><span style="color:#c0c5ce;">sp </span><span style="color:#b48ead;">- </span><span style="color:#d08770;">1</span><span style="color:#b48ead;">];</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#c0c5ce;">sp </span><span style="color:#b48ead;">-= </span><span style="color:#d08770;">1</span><span style="color:#b48ead;">;</span><span style="color:#c0c5ce;">
</span></pre>
<p>The <code>st</code> array is our stack, <code>sp</code> is a pointer to the last element of the stack. What's left? We need some additional C code for compilation by real C compiler.</p>
<h1 id="our-first-compiler">Our first compiler</h1>
<p>Let's just put all things together:</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">open </span><span style="color:#8fa1b3;">System</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">let</span><span style="color:#96b5b4;"> [&lt;Literal&gt;] </span><span style="color:#bf616a;">ST_SIZE </span><span style="color:#b48ead;">= </span><span style="color:#d08770;">100</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">let</span><span style="color:#96b5b4;"> [&lt;Literal&gt;] </span><span style="color:#bf616a;">C_CODE </span><span style="color:#b48ead;">= </span><span style="color:#c0c5ce;">&quot;&quot;&quot;</span><span style="color:#a3be8c;">#include &lt;stdio.h&gt;</span><span style="color:#a3be8c;">
</span><span style="color:#a3be8c;">  </span><span style="color:#a3be8c;">int main(int argc, char** argv) {{ </span><span style="color:#a3be8c;">
</span><span style="color:#a3be8c;">  </span><span style="color:#a3be8c;">int st[{0}], sp = 0;</span><span style="color:#a3be8c;">
</span><span style="color:#a3be8c;">{1}</span><span style="color:#a3be8c;">
</span><span style="color:#a3be8c;">  </span><span style="color:#a3be8c;">printf(&quot;</span><span style="color:#b48ead;">%d</span><span style="color:#a3be8c;">\n&quot;, st[sp - 1]);</span><span style="color:#a3be8c;">
</span><span style="color:#a3be8c;">  </span><span style="color:#a3be8c;">return 0;</span><span style="color:#a3be8c;">
</span><span style="color:#a3be8c;">}}</span><span style="color:#c0c5ce;">&quot;&quot;&quot;</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">type </span><span style="color:#c0c5ce;">IR </span><span style="color:#b48ead;">=</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">|</span><span style="color:#c0c5ce;"> Push </span><span style="color:#b48ead;">of </span><span style="color:#c0c5ce;">int</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">|</span><span style="color:#c0c5ce;"> Op </span><span style="color:#b48ead;">of </span><span style="color:#c0c5ce;">string</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">scan </span><span style="color:#b48ead;">(</span><span style="color:#bf616a;">source</span><span style="color:#b48ead;">: </span><span style="color:#c0c5ce;">string</span><span style="color:#b48ead;">) =</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">tokens </span><span style="color:#b48ead;">=</span><span style="color:#c0c5ce;"> source.Split </span><span style="color:#a3be8c;">&#39; &#39;</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">[ for</span><span style="color:#c0c5ce;"> tok </span><span style="color:#b48ead;">in</span><span style="color:#c0c5ce;"> tokens </span><span style="color:#b48ead;">-&gt; </span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">match</span><span style="color:#c0c5ce;"> Int32.TryParse tok </span><span style="color:#b48ead;">with</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">| </span><span style="color:#d08770;">true</span><span style="color:#b48ead;">,</span><span style="color:#c0c5ce;"> num </span><span style="color:#b48ead;">-&gt;</span><span style="color:#c0c5ce;"> Push num</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">| _ -&gt;</span><span style="color:#c0c5ce;"> Op tok  </span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">]</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">trans </span><span style="color:#b48ead;">(</span><span style="color:#bf616a;">ir</span><span style="color:#b48ead;">: </span><span style="color:#c0c5ce;">IR list</span><span style="color:#b48ead;">) =</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">[ for</span><span style="color:#c0c5ce;"> instr </span><span style="color:#b48ead;">in</span><span style="color:#c0c5ce;"> ir </span><span style="color:#b48ead;">do</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">match</span><span style="color:#c0c5ce;"> instr </span><span style="color:#b48ead;">with</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">|</span><span style="color:#c0c5ce;"> Push value </span><span style="color:#b48ead;">-&gt; </span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">yield</span><span style="color:#c0c5ce;"> sprintf &quot;</span><span style="color:#a3be8c;">  st[sp] = </span><span style="color:#b48ead;">%d</span><span style="color:#a3be8c;">;</span><span style="color:#c0c5ce;">&quot; value</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">yield </span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">  sp += 1;</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">|</span><span style="color:#c0c5ce;"> Op op </span><span style="color:#b48ead;">-&gt; </span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">yield</span><span style="color:#c0c5ce;"> sprintf &quot;</span><span style="color:#a3be8c;">  st[sp - 2] = st[sp - 2] </span><span style="color:#b48ead;">%s</span><span style="color:#a3be8c;"> st[sp - 1];</span><span style="color:#c0c5ce;">&quot; op</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">            </span><span style="color:#b48ead;">yield </span><span style="color:#c0c5ce;">&quot;</span><span style="color:#a3be8c;">  sp -= 1;</span><span style="color:#c0c5ce;">&quot; </span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">] |&gt;</span><span style="color:#c0c5ce;"> String.concat &quot;</span><span style="color:#d08770;">\n</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">rpnToC </span><span style="color:#b48ead;">(</span><span style="color:#bf616a;">source</span><span style="color:#b48ead;">: </span><span style="color:#c0c5ce;">string</span><span style="color:#b48ead;">) = </span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">code </span><span style="color:#b48ead;">=</span><span style="color:#c0c5ce;"> source </span><span style="color:#b48ead;">|&gt;</span><span style="color:#c0c5ce;"> scan </span><span style="color:#b48ead;">|&gt;</span><span style="color:#c0c5ce;"> trans</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">String.Format</span><span style="color:#b48ead;">(</span><span style="color:#c0c5ce;">C</span><span style="color:#b48ead;">_</span><span style="color:#c0c5ce;">CODE</span><span style="color:#b48ead;">,</span><span style="color:#c0c5ce;"> ST</span><span style="color:#b48ead;">_</span><span style="color:#c0c5ce;">SIZE</span><span style="color:#b48ead;">,</span><span style="color:#c0c5ce;"> code</span><span style="color:#b48ead;">)</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">printfn &quot;</span><span style="color:#b48ead;">%s</span><span style="color:#c0c5ce;">&quot; </span><span style="color:#b48ead;">(</span><span style="color:#c0c5ce;">rpnToC &quot;</span><span style="color:#a3be8c;">2 2 + 3 -</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#b48ead;">)</span><span style="color:#c0c5ce;">
</span></pre>
<p>The <code>rpnToC</code> function is our compilation pipeline. Literally! What's the output?</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">#include </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#a3be8c;">stdio.h</span><span style="color:#c0c5ce;">&gt;</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">int </span><span style="color:#8fa1b3;">main</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">int </span><span style="color:#bf616a;">argc</span><span style="color:#c0c5ce;">, </span><span style="color:#b48ead;">char</span><span style="color:#c0c5ce;">** </span><span style="color:#bf616a;">argv</span><span style="color:#c0c5ce;">) {</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> st[</span><span style="color:#d08770;">100</span><span style="color:#c0c5ce;">], sp = </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#c0c5ce;">st[sp] = </span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">;</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#c0c5ce;">sp += </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">;</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#c0c5ce;">st[sp] = </span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">;</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#c0c5ce;">sp += </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">;</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#c0c5ce;">st[sp - </span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">] = st[sp - </span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">] + st[sp - </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">];</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#c0c5ce;">sp -= </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">;</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#c0c5ce;">st[sp] = </span><span style="color:#d08770;">3</span><span style="color:#c0c5ce;">;</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#c0c5ce;">sp += </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">;</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#c0c5ce;">st[sp - </span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">] = st[sp - </span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">] - st[sp - </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">];</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#c0c5ce;">sp -= </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">;</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#96b5b4;">printf</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#d08770;">%d</span><span style="color:#96b5b4;">\n</span><span style="color:#c0c5ce;">&quot;, st[sp - </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">]);</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">return </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">}</span><span style="color:#c0c5ce;">
</span></pre>
<p>Let's talk a little bit about the result. It's weird that our compiler can translate only constant expressions. Clearly, we can compute it right in the compile-time, no need to translate it at all. But consider that some arguments can come into stack from the outside. e.g. from command line arguments. OK, let's stop here. We can add command line processing to our implementation later. For now it's more important to understand compiler design at a high-level.</p>
<h2 id="ssa-form">SSA form</h2>
<p><a href="https://en.wikipedia.org/wiki/Static_single_assignment_form">Static single assignment form</a> sounds important for every compiler developer. What it is?</p>
<p>For now the compiler generates plain C code without any need of the virtual machine. But why do we need to generate code working with the stack in the runtime? Let's replace the stack array with plain variables. For every expression we will introduce a new one, and every variable should be assigned just once. Just no need to skimp on names. :)</p>
<p>And... this is SSA form! Our new compiler:</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">open </span><span style="color:#8fa1b3;">System</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">open </span><span style="color:#8fa1b3;">System.Text</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">let</span><span style="color:#96b5b4;"> [&lt;Literal&gt;] </span><span style="color:#bf616a;">C_CODE </span><span style="color:#b48ead;">= </span><span style="color:#c0c5ce;">&quot;&quot;&quot;</span><span style="color:#a3be8c;">#include &lt;stdio.h&gt;</span><span style="color:#a3be8c;">
</span><span style="color:#a3be8c;">int main(int argc, char** argv) {{</span><span style="color:#a3be8c;">
</span><span style="color:#a3be8c;">{0}</span><span style="color:#a3be8c;">
</span><span style="color:#a3be8c;">  </span><span style="color:#a3be8c;">printf(&quot;</span><span style="color:#b48ead;">%d</span><span style="color:#a3be8c;">\n&quot;, {1});</span><span style="color:#a3be8c;">
</span><span style="color:#a3be8c;">  </span><span style="color:#a3be8c;">return 0;</span><span style="color:#a3be8c;">
</span><span style="color:#a3be8c;">}}</span><span style="color:#c0c5ce;">&quot;&quot;&quot;</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">type </span><span style="color:#c0c5ce;">IR </span><span style="color:#b48ead;">=</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">|</span><span style="color:#c0c5ce;"> Push </span><span style="color:#b48ead;">of </span><span style="color:#c0c5ce;">int</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">|</span><span style="color:#c0c5ce;"> Op </span><span style="color:#b48ead;">of </span><span style="color:#c0c5ce;">string</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">type </span><span style="color:#c0c5ce;">Env </span><span style="color:#b48ead;">= {</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">stack</span><span style="color:#b48ead;">: </span><span style="color:#c0c5ce;">string list</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">nameCounter</span><span style="color:#b48ead;">: </span><span style="color:#c0c5ce;">int</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">}</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">emptyEnv </span><span style="color:#b48ead;">= {</span><span style="color:#c0c5ce;"> stack </span><span style="color:#b48ead;">= [];</span><span style="color:#c0c5ce;"> nameCounter </span><span style="color:#b48ead;">= </span><span style="color:#d08770;">0 </span><span style="color:#b48ead;">}</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">scan </span><span style="color:#b48ead;">(</span><span style="color:#bf616a;">source</span><span style="color:#b48ead;">: </span><span style="color:#c0c5ce;">string</span><span style="color:#b48ead;">) =</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">tokens </span><span style="color:#b48ead;">=</span><span style="color:#c0c5ce;"> source.Split </span><span style="color:#a3be8c;">&#39; &#39;</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">[ for</span><span style="color:#c0c5ce;"> tok </span><span style="color:#b48ead;">in</span><span style="color:#c0c5ce;"> tokens </span><span style="color:#b48ead;">-&gt; </span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">match</span><span style="color:#c0c5ce;"> Int32.TryParse tok </span><span style="color:#b48ead;">with</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">| </span><span style="color:#d08770;">true</span><span style="color:#b48ead;">,</span><span style="color:#c0c5ce;"> num </span><span style="color:#b48ead;">-&gt;</span><span style="color:#c0c5ce;"> Push num</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">| _ -&gt;</span><span style="color:#c0c5ce;"> Op tok  </span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">]</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">trans </span><span style="color:#b48ead;">(</span><span style="color:#bf616a;">ir</span><span style="color:#b48ead;">: </span><span style="color:#c0c5ce;">IR list</span><span style="color:#b48ead;">) =</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">transInstr </span><span style="color:#b48ead;">(</span><span style="color:#bf616a;">env</span><span style="color:#b48ead;">: </span><span style="color:#c0c5ce;">Env</span><span style="color:#b48ead;">,</span><span style="color:#bf616a;"> code</span><span style="color:#b48ead;">: </span><span style="color:#c0c5ce;">StringBuilder</span><span style="color:#b48ead;">) = function</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">|</span><span style="color:#c0c5ce;"> Push value </span><span style="color:#b48ead;">-&gt; </span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">code </span><span style="color:#b48ead;">=</span><span style="color:#c0c5ce;"> code.AppendLine </span><span style="color:#b48ead;">(</span><span style="color:#c0c5ce;">sprintf &quot;</span><span style="color:#a3be8c;">  int t</span><span style="color:#b48ead;">%d</span><span style="color:#a3be8c;"> = </span><span style="color:#b48ead;">%d</span><span style="color:#a3be8c;">;</span><span style="color:#c0c5ce;">&quot; env.nameCounter value</span><span style="color:#b48ead;">)</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">stack </span><span style="color:#b48ead;">= (</span><span style="color:#c0c5ce;">sprintf &quot;</span><span style="color:#a3be8c;">t</span><span style="color:#b48ead;">%d</span><span style="color:#c0c5ce;">&quot; env.nameCounter</span><span style="color:#b48ead;">) ::</span><span style="color:#c0c5ce;"> env.stack</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">{</span><span style="color:#c0c5ce;"> env </span><span style="color:#b48ead;">with</span><span style="color:#c0c5ce;"> stack </span><span style="color:#b48ead;">=</span><span style="color:#c0c5ce;"> stack</span><span style="color:#b48ead;">;</span><span style="color:#c0c5ce;"> nameCounter </span><span style="color:#b48ead;">=</span><span style="color:#c0c5ce;"> env.nameCounter </span><span style="color:#b48ead;">+ </span><span style="color:#d08770;">1</span><span style="color:#b48ead;">},</span><span style="color:#c0c5ce;"> code</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">|</span><span style="color:#c0c5ce;"> Op op </span><span style="color:#b48ead;">-&gt; </span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">let (</span><span style="color:#bf616a;">leftOperand </span><span style="color:#b48ead;">:: </span><span style="color:#c0c5ce;">rightOperand </span><span style="color:#b48ead;">:: </span><span style="color:#c0c5ce;">stack</span><span style="color:#b48ead;">) =</span><span style="color:#c0c5ce;"> env.stack</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">code </span><span style="color:#b48ead;">=</span><span style="color:#c0c5ce;"> code.AppendLine </span><span style="color:#b48ead;">(</span><span style="color:#c0c5ce;">sprintf &quot;</span><span style="color:#a3be8c;">  int t</span><span style="color:#b48ead;">%d</span><span style="color:#a3be8c;"> = </span><span style="color:#b48ead;">%s %s %s</span><span style="color:#a3be8c;">;</span><span style="color:#c0c5ce;">&quot; env.nameCounter rightOperand op leftOperand</span><span style="color:#b48ead;">)</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">stack </span><span style="color:#b48ead;">= (</span><span style="color:#c0c5ce;">sprintf &quot;</span><span style="color:#a3be8c;">t</span><span style="color:#b48ead;">%d</span><span style="color:#c0c5ce;">&quot; env.nameCounter</span><span style="color:#b48ead;">) ::</span><span style="color:#c0c5ce;"> stack</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">        </span><span style="color:#b48ead;">{</span><span style="color:#c0c5ce;"> env </span><span style="color:#b48ead;">with</span><span style="color:#c0c5ce;"> stack </span><span style="color:#b48ead;">=</span><span style="color:#c0c5ce;"> stack</span><span style="color:#b48ead;">;</span><span style="color:#c0c5ce;"> nameCounter </span><span style="color:#b48ead;">=</span><span style="color:#c0c5ce;"> env.nameCounter </span><span style="color:#b48ead;">+ </span><span style="color:#d08770;">1</span><span style="color:#b48ead;">},</span><span style="color:#c0c5ce;"> code</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">ir </span><span style="color:#b48ead;">|&gt;</span><span style="color:#c0c5ce;"> List.fold transInstr </span><span style="color:#b48ead;">(</span><span style="color:#c0c5ce;">emptyEnv</span><span style="color:#b48ead;">,</span><span style="color:#c0c5ce;"> StringBuilder</span><span style="color:#d08770;">()</span><span style="color:#b48ead;">)</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">rpnToC </span><span style="color:#b48ead;">(</span><span style="color:#bf616a;">source</span><span style="color:#b48ead;">: </span><span style="color:#c0c5ce;">string</span><span style="color:#b48ead;">) = </span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">env, code </span><span style="color:#b48ead;">=</span><span style="color:#c0c5ce;"> source </span><span style="color:#b48ead;">|&gt;</span><span style="color:#c0c5ce;"> scan </span><span style="color:#b48ead;">|&gt;</span><span style="color:#c0c5ce;"> trans</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">String.Format</span><span style="color:#b48ead;">(</span><span style="color:#c0c5ce;">C</span><span style="color:#b48ead;">_</span><span style="color:#c0c5ce;">CODE</span><span style="color:#b48ead;">,</span><span style="color:#c0c5ce;"> code</span><span style="color:#b48ead;">,</span><span style="color:#c0c5ce;"> env.stack.Head</span><span style="color:#b48ead;">)</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">printfn &quot;</span><span style="color:#b48ead;">%s</span><span style="color:#c0c5ce;">&quot; </span><span style="color:#b48ead;">(</span><span style="color:#c0c5ce;">rpnToC &quot;</span><span style="color:#a3be8c;">2 2 + 3 -</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#b48ead;">) </span><span style="color:#c0c5ce;">
</span></pre>
<p>Please pay attention that there is no stack in the produced C code. The stack processing performs in the compile-time. This is our internal stack for variables' names (not values as in the previous version):</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">type </span><span style="color:#c0c5ce;">Env </span><span style="color:#b48ead;">= {</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">stack</span><span style="color:#b48ead;">: </span><span style="color:#c0c5ce;">string list</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">nameCounter</span><span style="color:#b48ead;">: </span><span style="color:#c0c5ce;">int</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">}</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">emptyEnv </span><span style="color:#b48ead;">= {</span><span style="color:#c0c5ce;"> stack </span><span style="color:#b48ead;">= [];</span><span style="color:#c0c5ce;"> nameCounter </span><span style="color:#b48ead;">= </span><span style="color:#d08770;">0 </span><span style="color:#b48ead;">}</span><span style="color:#c0c5ce;">
</span></pre>
<p>The processing of the stack can be modeled through folding. This is a standard way in FP to perform statefull operations:</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">let </span><span style="color:#bf616a;">trans </span><span style="color:#b48ead;">(</span><span style="color:#bf616a;">ir</span><span style="color:#b48ead;">: </span><span style="color:#c0c5ce;">IR list</span><span style="color:#b48ead;">) =</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">transInstr </span><span style="color:#b48ead;">(</span><span style="color:#bf616a;">env</span><span style="color:#b48ead;">: </span><span style="color:#c0c5ce;">Env</span><span style="color:#b48ead;">,</span><span style="color:#bf616a;"> code</span><span style="color:#b48ead;">: </span><span style="color:#c0c5ce;">StringBuilder</span><span style="color:#b48ead;">) = function</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">|</span><span style="color:#c0c5ce;"> Push value </span><span style="color:#b48ead;">-&gt; </span><span style="color:#65737e;">(* ... *)</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">|</span><span style="color:#c0c5ce;"> Op op </span><span style="color:#b48ead;">-&gt; </span><span style="color:#65737e;">(* ... *)</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">    </span><span style="color:#c0c5ce;">ir </span><span style="color:#b48ead;">|&gt;</span><span style="color:#c0c5ce;"> List.fold transInstr </span><span style="color:#b48ead;">(</span><span style="color:#c0c5ce;">emptyEnv</span><span style="color:#b48ead;">,</span><span style="color:#c0c5ce;"> StringBuilder</span><span style="color:#d08770;">()</span><span style="color:#b48ead;">)</span><span style="color:#c0c5ce;">
</span></pre>
<p>There is also some non-safe code:</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">let (</span><span style="color:#bf616a;">leftOperand </span><span style="color:#b48ead;">:: </span><span style="color:#c0c5ce;">rightOperand </span><span style="color:#b48ead;">:: </span><span style="color:#c0c5ce;">stack</span><span style="color:#b48ead;">) =</span><span style="color:#c0c5ce;"> env.stack</span><span style="color:#c0c5ce;">
</span></pre>
<p>It fails when stack contains not enough elements. Clear error messages are another excersise for the reader. Compilation errors are very important part of the compiler!</p>
<p>Final output:</p>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">#include </span><span style="color:#c0c5ce;">&lt;</span><span style="color:#a3be8c;">stdio.h</span><span style="color:#c0c5ce;">&gt;</span><span style="color:#c0c5ce;">
</span><span style="color:#b48ead;">int </span><span style="color:#8fa1b3;">main</span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">int </span><span style="color:#bf616a;">argc</span><span style="color:#c0c5ce;">, </span><span style="color:#b48ead;">char</span><span style="color:#c0c5ce;">** </span><span style="color:#bf616a;">argv</span><span style="color:#c0c5ce;">) {</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> t0 = </span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">;</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> t1 = </span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">;</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> t2 = t0 + t1;</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> t3 = </span><span style="color:#d08770;">3</span><span style="color:#c0c5ce;">;</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">int</span><span style="color:#c0c5ce;"> t4 = t2 - t3;</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#96b5b4;">printf</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#d08770;">%d</span><span style="color:#96b5b4;">\n</span><span style="color:#c0c5ce;">&quot;, t4);</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">  </span><span style="color:#b48ead;">return </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">}</span><span style="color:#c0c5ce;">
</span></pre>
<p>It seems like a good start for a more complicated compiler, right? We can go with <a href="http://evincarofautumn.blogspot.com/2012/02/why-concatenative-programming-matters.html">stack languages</a> like Forth, Postscript, Joy or Factor. Even statically typed functional <a href="https://kittenlang.org/">language</a> can be stack-based! Obviously another way is to increase syntax complexity. But let's leave all these questions for later posts.</p>
<p>We wish you success in compiler design. Merry Christmas and Happy New Нear!</p>

    </div>

    
    

    <div class="post-footer">
        
            
            

        
    </div>
</article>


                </div>
            </main>

            
            
        </div>

      
          <script type="text/javascript" src="https:&#x2F;&#x2F;gsomix.github.io&#x2F;blog&#x2F;even.js" ></script>
      
    </body>

</html>
